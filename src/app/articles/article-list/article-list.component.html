<div class="articles-area">
  <div *ngIf='articles?.length > 0'>
    <div class="article-area">
      <div class="article-list">
        <div
          class="article-item"
          *ngFor="let item of articles | orderby: ['-date']">
          <div class="article-item-header underline-animation"
            [routerLink]="['/articles', item._id]"
            routerLinkActive="active">
            <div class="article-item-avator">
              <img class="avatar" src="data:image/png;base64,{{item.author.icon}}">
            </div>
            <div class="article-item-subtitle">
              <div class="article-item-author-name">{{item.author.userId}}</div>
              <div class="article-item-date">{{item.date | date: 'yyyy/MM/dd HH:mm' }}</div>
            </div>
            <div class="article-item-title-area">
              <div  class="article-item-title">{{item.title}}</div>
            </div>
          </div>
          <div class="article-item-content">
            <div *ngIf="item.isMarkdown; then markdown else plainText"></div>
            <ng-template #markdown>
              <p [innerHTML]="item.body | toMarkdown" class="markdown-body"></p>
            </ng-template>
            <ng-template #plainText>
              <pre [innerHTML]="item.body" class="plain-text-body"></pre>                
            </ng-template>
          </div>


          <ng-container *ngIf="item.showCommentDetail; then displayCommentDetail else displayComment"></ng-container>
          
          <ng-template #displayComment>
            <div class="article-item-comments">
              <div *ngIf='item.comments' class="article-item-comments-count">コメント{{item.comments.length}}件</div>
              <div *ngIf='item.comments' class="article-item-comments-area">
                <div 
                  *ngFor="let comment of item.comments"
                  class="article-item-comment-user-wrapper">
                    <img
                    mdTooltip="【{{comment.user.userId}}】&#013;{{comment.text}}"
                    class="article-item-comment-user"
                    src="data:image/png;base64,{{comment.user.icon}}">
                </div>
              </div>
              <div class="article-item-operation-area">
                  <button 
                  md-button
                  type="button"
                  class="show-comment-editor-btn"
                  (click)='createNewComment(item)'><i class="fa fa-fw fa-commenting"></i>  コメントする</button>
              </div>
              <div style="flex: 1 1 auto"></div>
              <button
                md-icon-button
                mdTooltip="コメント詳細を開く"
                mdTooltipPosition="above"
                mdTooltipShowDelay="500"
                type="button"
                class="toggle-comment-detail-btn"
                (click)='toggleCommentDetail(item)'><i class="fa fa-fw fa-chevron-down"></i></button>
            </div>
            <div *ngIf="item.newComment" class="article-comment-editor">
              <img class="article-comment-author-icon" *ngIf="auth.loginUser" src="data:image/png;base64,{{auth.loginUser.icon }}">
              <textarea
                class="register-comment-body"
                appAutofocus
                [(ngModel)]="item.newComment.text"
                placeholder="コメントする..." ></textarea>
                <button 
                md-button
                type="button"
                class="cancel-comment-btn"
                (click)='cancelNewComment(item)'><i class="fa fa-fw fa-times"></i>  キャンセル</button>

                <button
                md-raised-button
                class="register-comment-btn"
                color="primary"
                type="button"
                id="registe-comment-btn"
                (click)='registerComment(item.articleId, item.newComment)'><i class="fa fa-fw fa-commenting"></i>  追加</button>
            </div>
          </ng-template>

          <ng-template #displayCommentDetail>
            <div class="article-comment-detail-area">
              <app-comment-list
                [hasCloseBtn]="true"
                _idOfArticle="{{item._id}}"
                [comments]="item.comments"
                (refresh)="refreshComments(item, $event)"
                (close)="toggleCommentDetail(item)"
              ></app-comment-list>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>

